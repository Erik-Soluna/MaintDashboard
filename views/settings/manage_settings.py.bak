{{extend 'layout.html'}}

<h1>Manage Settings</h1>

<!-- Equipment Categories -->
<h3>Equipment Categories</h3>
<div class="input-group mb-3">
  <input type="text" class="form-control" id="categoryInput" placeholder="Enter category name">
  <div class="input-group-append">
    <button class="btn btn-primary" id="addCategoryBtn">Add Category</button>
  </div>
</div>
<ul class="list-group" id="categoryList">
  {{for category in categories:}}
  <li class="list-group-item d-flex justify-content-between align-items-center">
    {{=category.name}}
    <button class="btn btn-sm btn-danger delete-category" data-id="{{=category.id}}">Delete</button>
  </li>
  {{pass}}
</ul>

<hr>

<!-- Equipment Locations -->
<h3>Equipment Locations</h3>
<div class="input-group mb-3">
  <input type="text" class="form-control" id="locationInput" placeholder="Enter location name">
  <div class="input-group-append">
    <button class="btn btn-primary" id="addLocationBtn">Add Location</button>
  </div>
</div>
<ul class="list-group" id="locationList">
  {{for location in locations:}}
  <li class="list-group-item d-flex justify-content-between align-items-center">
    {{=location.name}}
    <button class="btn btn-sm btn-danger delete-location" data-id="{{=location.id}}">Delete</button>
  </li>
  {{pass}}
</ul>

<script>
  document.getElementById('addCategoryBtn').addEventListener('click', function() {
    const categoryName = document.getElementById('categoryInput').value;
    fetch('{{=URL("settings", "add_category")}}', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: new URLSearchParams({ 'category_name': categoryName })
    }).then(response => response.json())
    .then(data => {
      if (data.status === 'success') location.reload();
      else alert(data.message);
    });
  });

  document.querySelectorAll('.delete-category').forEach(button => {
    button.addEventListener('click', function() {
      const categoryId = this.getAttribute('data-id');
      fetch('{{=URL("settings", "delete_category")}}', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams({ 'category_id': categoryId })
      }).then(response => response.json())
      .then(data => {
        if (data.status === 'success') location.reload();
        else alert(data.message);
      });
    });
  });

  document.getElementById('addLocationBtn').addEventListener('click', function() {
    const locationName = document.getElementById('locationInput').value;
    fetch('{{=URL("settings", "add_location")}}', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: new URLSearchParams({ 'location_name': locationName })
    }).then(response => response.json())
    .then(data => {
      if (data.status === 'success') location.reload();
      else alert(data.message);
    });
  });

  document.querySelectorAll('.delete-location').forEach(button => {
    button.addEventListener('click', function() {
      const locationId = this.getAttribute('data-id');
      fetch('{{=URL("settings", "delete_location")}}', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams({ 'location_id': locationId })
      }).then(response => response.json())
      .then(data => {
        if (data.status === 'success') location.reload();
        else alert(data.message);
      });
    });
  });
</script>

{% extends 'base.html' %}
{% load static %}

{% block title %}Builder.io Overview - Maintenance Dashboard{% endblock %}

{% block extra_css %}
<!-- Builder.io specific styles -->
<style>
  /* Ensure the React app takes full height */
  #builderio-root {
    height: 100vh;
    width: 100%;
  }
  
  /* Hide Django navigation when viewing Builder.io content */
  .builderio-fullscreen #main-nav,
  .builderio-fullscreen .container {
    display: none;
  }
  
  /* Loading state */
  .builderio-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100vh;
    background: #10161C;
    color: white;
    font-size: 1.5rem;
  }
</style>
{% endblock %}

{% block content %}
<div id="builderio-root">
  <div class="builderio-loading">
    Loading Builder.io Overview...
  </div>
</div>

<!-- Load the built React app -->
<script>
  // Load the built React app
  const loadBuilderIOApp = () => {
    const root = document.getElementById('builderio-root');
    
    // Create iframe to load the built React app
    const iframe = document.createElement('iframe');
    iframe.src = "{% static 'vibes-r-us/dist/spa/index.html' %}";
    iframe.style.cssText = "width: 100%; height: 100vh; border: none;";
    iframe.title = "Builder.io Overview";
    
    // Handle iframe load
    iframe.onload = () => {
      root.innerHTML = '';
      root.appendChild(iframe);
      
      // Try to communicate with the iframe to inject Django data
      try {
        const iframeWindow = iframe.contentWindow;
        if (iframeWindow) {
          // Override the fetch function in the iframe to use Django endpoints
          iframeWindow.fetch = (url, options) => {
            if (url.startsWith('/core/overview/data/')) {
              return fetch(url, options);
            }
            return fetch(url, options);
          };
        }
      } catch (e) {
        console.log('Could not override iframe fetch (CORS restriction)');
      }
    };
    
    // Handle iframe errors
    iframe.onerror = () => {
      root.innerHTML = `
        <div class="builderio-loading">
          <div style="text-align: center;">
            <h2>Error Loading Builder.io Overview</h2>
            <p>Failed to load the Builder.io application.</p>
            <p>Please check the console for more details.</p>
          </div>
        </div>
      `;
    };
  };
  
  // Load the app when the page is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadBuilderIOApp);
  } else {
    loadBuilderIOApp();
  }
</script>
{% endblock %}

{% block extra_js %}
<!-- No additional JavaScript needed - React app handles everything -->
{% endblock %}

# GitHub Issue Reporting for Playwright Test Failures

## Overview

The Playwright test runner now automatically creates detailed GitHub issues when tests fail, providing comprehensive debugging information including screenshots, error details, and environment context.

## Features

### üö® Automatic Issue Creation
- Creates GitHub issues when Playwright tests fail
- Includes detailed test reports with pass/fail statistics
- Attaches screenshots from failed tests
- Provides environment and execution context

### üìä Comprehensive Reporting
- Test execution summary with pass/fail counts
- Detailed error messages and stack traces
- Warning information for potential issues
- Screenshot and HTML dump counts

### üîß Environment Context
- Docker container information
- Base URL and test environment details
- Test request/prompt that caused the failure
- Timestamp and execution metadata

## Configuration

### 1. GitHub Personal Access Token

Create a GitHub Personal Access Token with the following permissions:
- `repo` (for private repositories)
- `public_repo` (for public repositories)

**Steps:**
1. Go to [GitHub Settings > Tokens](https://github.com/settings/tokens)
2. Click "Generate new token (classic)"
3. Select the required permissions
4. Copy the generated token

### 2. Environment Variables

Add the following variables to your `.env` file:

```bash
# Required
GITHUB_TOKEN=your_github_personal_access_token_here

# Optional (defaults shown)
GITHUB_REPO=erikw/MaintDashboard
GITHUB_OWNER=erikw
GITHUB_REPO_NAME=MaintDashboard
```

### 3. Docker Compose Configuration

The Playwright service in `docker-compose.yml` is already configured to use these environment variables:

```yaml
playwright:
  environment:
    - GITHUB_TOKEN=${GITHUB_TOKEN:-}
    - GITHUB_REPO=${GITHUB_REPO:-erikw/MaintDashboard}
    - GITHUB_OWNER=${GITHUB_OWNER:-erikw}
    - GITHUB_REPO_NAME=${GITHUB_REPO_NAME:-MaintDashboard}
```

## How It Works

### 1. Test Execution
When Playwright tests run (either manually or via the automated runner), the `SmartTestRunner` class:
- Executes the requested tests
- Captures screenshots and HTML dumps on failures
- Generates a comprehensive test report

### 2. Failure Detection
After test execution, the system:
- Analyzes the test results for failures
- Counts passed/failed tests and errors
- Prepares failure details for GitHub issue creation

### 3. Issue Creation
If failures are detected:
- Creates a detailed GitHub issue with test summary
- Includes all error messages and warnings
- Attaches screenshots from failed tests as comments
- Provides debugging context and next steps

### 4. Issue Content
Each GitHub issue includes:
- **Title**: Descriptive failure summary
- **Summary**: Test statistics and environment info
- **Failed Tests**: Detailed breakdown of each failure
- **Passed Tests**: List of successful tests
- **Environment Details**: Container and URL information
- **Next Steps**: Suggested debugging actions

## Issue Labels

Automatically applied labels:
- `playwright-test-failure`: Identifies automated test failures
- `automated`: Indicates the issue was created automatically
- `bug`: Categorizes as a bug report

## Example Issue

```markdown
## üö® Playwright Test Failure Report

**Test Run:** 1/15/2024, 2:30:45 PM
**Environment:** Docker Container (http://web:8000)

### üìä Summary
- **Total Tests:** 3
- **Passed:** 1 ‚úÖ
- **Failed:** 2 ‚ùå
- **Total Errors:** 3
- **Total Warnings:** 1

### üéØ Test Request
```
Create equipment with all required fields and delete it
```

### ‚ùå Failed Tests

#### 1. Create Equipment
**Timestamp:** 1/15/2024, 2:30:45 PM

**Errors:**
- Element not found: #equipment-name
- Form submission failed: 500 Internal Server Error

**Screenshots:** 2 captured
**HTML Dumps:** 1 captured

---

#### 2. Delete Equipment
**Timestamp:** 1/15/2024, 2:31:15 PM

**Errors:**
- Confirmation dialog not found

**Screenshots:** 1 captured

### ‚úÖ Passed Tests
- Test Login

### üîß Environment Details
- **Base URL:** http://web:8000
- **Container:** playwright_runner
- **Report File:** smart-test-report.json
- **Generated:** 2024-01-15T14:31:45.123Z

### üìã Next Steps
1. Review the failed test details above
2. Check screenshots and HTML dumps for visual clues
3. Verify the test environment is accessible
4. Run tests locally to reproduce the issue
5. Update test logic or fix underlying application issues

---
*This issue was automatically generated by the Playwright test runner.*
```

## Troubleshooting

### Issue Creation Fails
- **Check GitHub Token**: Verify the token has correct permissions
- **Repository Access**: Ensure the token can access the target repository
- **Network Connectivity**: Verify the container can reach GitHub API
- **Rate Limits**: GitHub has API rate limits; check for 403 errors

### Screenshots Not Uploading
- **File Permissions**: Ensure screenshots are readable
- **File Size**: Large screenshots may exceed GitHub limits
- **Base64 Encoding**: Check for encoding errors in logs

### Missing Environment Variables
- **Token Not Set**: Issue creation will be disabled with a warning
- **Invalid Repository**: Check owner/repo name format
- **Docker Environment**: Ensure variables are passed to container

## Security Considerations

### Token Security
- **Never commit tokens**: Use environment variables or secrets
- **Minimal permissions**: Only grant necessary repository access
- **Token rotation**: Regularly rotate personal access tokens
- **Container isolation**: Tokens are only available in the Playwright container

### Repository Access
- **Public repositories**: Use `public_repo` permission only
- **Private repositories**: Use `repo` permission with care
- **Organization repos**: Ensure proper organization access

## Monitoring and Maintenance

### Log Monitoring
Check Playwright service logs for:
- Issue creation success/failure messages
- Screenshot upload status
- GitHub API error responses

### Report Files
Generated files in `playwright/`:
- `smart-test-report.json`: Detailed test results
- `runner.log`: Execution logs
- `screenshots/smart-tests/`: Test screenshots
- `html-dumps/smart-tests/`: HTML page dumps

### Cleanup
- **Screenshots**: Consider periodic cleanup of old screenshots
- **Reports**: Archive or delete old test reports
- **GitHub Issues**: Manually close resolved issues

## Integration with CI/CD

### GitHub Actions
The issue reporting works well with GitHub Actions:
- Issues are created in the same repository
- Screenshots are attached for visual debugging
- Environment context includes CI/CD details

### Other CI Systems
- Set environment variables in CI configuration
- Ensure containers have network access to GitHub API
- Consider rate limiting for high-frequency test runs

## Future Enhancements

### Planned Features
- **Issue Templates**: Customizable issue templates
- **Assignee Assignment**: Automatic assignee based on test failures
- **Milestone Integration**: Link issues to project milestones
- **Slack/Discord Integration**: Additional notification channels
- **Test Flakiness Detection**: Identify and report flaky tests
- **Performance Metrics**: Include test execution time and performance data 